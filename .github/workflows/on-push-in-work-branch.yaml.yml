name: Push Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‡ÑƒÑ Ğ²ĞµÑ‚ĞºÑƒ - ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Dev ÑĞµÑ€Ğ²ĞµÑ€Ğ°

on:
    push:
        branches:
            - '**'
            - '!main'
            - '!master'
            - '!develop'

env:
    SERVICE_NAME: ${{ github.event.repository.name }}
    SYSTEM_REPO: loom-system
    BRANCH_NAME: ${{ github.ref_name }}
    AUTHOR_NAME: ${{ github.actor }}

jobs:
    update-dev-server:
        runs-on: self-hosted

        steps:
            -   name: ğŸ“‹ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿ÑƒÑˆĞµ
                run: |
                    echo ""
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘           ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• DEV Ğ¡Ğ•Ğ Ğ’Ğ•Ğ Ğ                           â•‘"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    echo ""
                    echo "ğŸ“¦ Ğ¡ĞµÑ€Ğ²Ğ¸Ñ:      ${{ env.SERVICE_NAME }}"
                    echo "ğŸŒ¿ Ğ’ĞµÑ‚ĞºĞ°:       ${{ env.BRANCH_NAME }}"
                    echo "ğŸ‘¤ ĞĞ²Ñ‚Ğ¾Ñ€:       ${{ env.AUTHOR_NAME }}"
                    echo "ğŸ“ ĞšĞ¾Ğ¼Ğ¼Ğ¸Ñ‚:      ${{ github.sha }}"
                    echo ""

            -   name: âš™ï¸ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ dev ÑĞµÑ€Ğ²ĞµÑ€Ğ°
                run: |
                    source .github/scripts/on-push-work-branch/load_dev_config.sh
                    load_dev_server_config

            -   name: ğŸ”„ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²ĞµÑ‚ĞºĞ¸ Ğ½Ğ° dev ÑĞµÑ€Ğ²ĞµÑ€Ğµ
                id: update_step
                run: |
                    source .github/scripts/on-push-work-branch/update_branch.sh
                    update_branch_on_server

            -   name: ğŸ‰ Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± ÑƒÑĞ¿ĞµÑ…Ğµ
                if: success()
                run: |
                    source .github/scripts/on-push-work-branch/notify.sh
                    send_success_notification

            -   name: âŒ Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
                if: failure()
                run: |
                    source .github/scripts/on-push-work-branch/notify.sh
                    send_failure_notification

            -   name: ğŸ“‹ Ğ˜Ñ‚Ğ¾Ğ³Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
                if: always()
                run: |
                    echo ""
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    Ğ˜Ğ¢ĞĞ“Ğ˜ ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯                        â•‘"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    echo ""
                    echo "ğŸ“¦ Ğ¡ĞµÑ€Ğ²Ğ¸Ñ:      ${{ env.SERVICE_NAME }}"
                    echo "ğŸŒ¿ Ğ’ĞµÑ‚ĞºĞ°:       ${{ env.BRANCH_NAME }}"
                    echo "ğŸ‘¤ ĞĞ²Ñ‚Ğ¾Ñ€:       ${{ env.AUTHOR_NAME }}"
                    echo "ğŸ–¥ï¸  Dev ÑĞµÑ€Ğ²ĞµÑ€:  ${{ env.DEV_HOST }}"
                    echo "ğŸŒ Dev Ğ´Ğ¾Ğ¼ĞµĞ½:   ${{ env.DEV_DOMAIN }}"
                    echo ""
                    echo "ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:      ${{ job.status }}"
                    echo "ğŸ”„ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:  ${{ steps.update_step.outcome }}"
                    echo ""
                    
                    if [ "${{ job.status }}" == "success" ]; then
                      echo "âœ… Ğ’ĞµÑ‚ĞºĞ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ° Ğ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚"
                    else
                      echo "âŒ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»Ğ¾ÑÑŒ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹"
                      echo "ğŸ” Ğ›Ğ¾Ğ³Ğ¸: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
                    fi
                    echo ""